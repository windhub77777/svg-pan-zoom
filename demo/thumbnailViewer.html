<!DOCTYPE html>
<html>
  <head>
    <script src="../dist/svg-pan-zoom.js"></script>
    <meta name="viewport" content="user-scalable=no, width=device-width, initial-scale=1, maximum-scale=1">
    <style tyle="text/css">
      body{
        width: 100%;
        height: 100%;
      }

      #mainViewContainer {
        width: 95%;
        height: 95%;
        border: 1px solid black;
        margin: 10px;
        padding: 3px;
        overflow: hidden;
      }

      #mainView {
        width: 100%;
        height: 100%;
      }

      .thumbViewClass {
        border: 1px solid black;
        position: absolute;
        bottom: 5px;
        left: 5px;
        width: 30%;
        height: 40%;
        overflow: hidden;
      }

      #thumbView {
        z-index: 110;
        background: white;
      }

      #scopeContainer {
        z-index: 120;
      }
    </style>
  </head>

  <body>
    <h1>Demo for Thumbnail Viewer</h1>
    <div id="mainViewContainer">
      <embed id="mainView" type="image/svg+xml" src="tiger.svg"/>
    </div>

    <div id="thumbViewContainer">
      <svg id="scopeContainer" onclick="window.thumb.click(evt)" onmousemove="window.thumb.click(evt)" class="thumbViewClass">
        <g>
          <rect id="scope" fill="red" fill-opacity="0.1" stroke="red" stroke-width="2px" x="0" y="0" width="0" height="0"/>
          <line id="line1" stroke="red" stroke-width="2px" x1="0" y1="0" x2="0" y2="0"/>
          <line id="line2" stroke="red" stroke-width="2px" x1="0" y1="0" x2="0" y2="0"/>
        </g>
      </svg>
      <embed id="thumbView" type="image/svg+xml" src="tiger.svg" class="thumbViewClass"/>
    </div>
    <script>
      window.onload = function() {
        updateScope = function (){
          var mainPanX   = window.main.getPan().x
            , mainPanY   = window.main.getPan().y
            , mainWidth  = window.main.getSizes().width
            , mainHeight = window.main.getSizes().height
            , mainZoom   = window.main.getSizes().realZoom
            , thumbPanX  = window.thumb.getPan().x
            , thumbPanY  = window.thumb.getPan().y
            , thumbZoom  = window.thumb.getSizes().realZoom;

          var thumByMainZoomRatio =  thumbZoom / mainZoom;

          var scopeX = thumbPanX - mainPanX * thumByMainZoomRatio;
          var scopeY = thumbPanY - mainPanY * thumByMainZoomRatio;
          var scopeWidth = mainWidth * thumByMainZoomRatio;
          var scopeHeight = mainHeight * thumByMainZoomRatio;
      
          var scope = document.getElementById('scope');
          var line1 = document.getElementById('line1');
          var line2 = document.getElementById('line2');

          scope.setAttribute("x", scopeX + 1);
          scope.setAttribute("y", scopeY + 1);
          scope.setAttribute("width", scopeWidth - 2);
          scope.setAttribute("height", scopeHeight - 2);
          line1.setAttribute("x1", scopeX + 1);
          line1.setAttribute("y1", scopeY + 1);
          line1.setAttribute("x2", scopeX + 1 + scopeWidth - 2);
          line1.setAttribute("y2", scopeY + 1 + scopeHeight - 2);
          line2.setAttribute("x1", scopeX + 1);
          line2.setAttribute("y1", scopeY + 1 + scopeHeight - 2);
          line2.setAttribute("x2", scopeX + 1 + scopeWidth - 2);
          line2.setAttribute("y2", scopeY + 1);
        };
        var beforePan = function(oldPan, newPan){
          var stopHorizontal = false
            , stopVertical = false
            , gutterWidth = 100
            , gutterHeight = 100
              // Computed variables
            , sizes = this.getSizes()
            , leftLimit = -((sizes.viewBox.x + sizes.viewBox.width) * sizes.realZoom) + gutterWidth
            , rightLimit = sizes.width - gutterWidth - (sizes.viewBox.x * sizes.realZoom)
            , topLimit = -((sizes.viewBox.y + sizes.viewBox.height) * sizes.realZoom) + gutterHeight
            , bottomLimit = sizes.height - gutterHeight - (sizes.viewBox.y * sizes.realZoom);
          customPan = {};
          customPan.x = Math.max(leftLimit, Math.min(rightLimit, newPan.x));
          customPan.y = Math.max(topLimit, Math.min(bottomLimit, newPan.y));
          return customPan;
        };

        window.main = svgPanZoom('#mainView', {
          zoomEnabled: true,
          controlIconsEnabled: true,
          fit: true,
          center: true,
          beforePan: beforePan
        });

        window.thumb = svgPanZoom('#thumbView', {
          zoomEnabled: false,
          panEnabled: false,
          controlIconsEnabled: false,
          dblClickZoomEnabled: false,
          preventMouseEventsDefault: true
        });

        window.main.setOnZoom(function(level){
          updateScope();
        });
        window.main.setOnPan(function(point){
          updateScope();
        });

        window.thumb.click = function(evt){
          if(evt.which == 0 && evt.button == 0){
            return false;
          }
          var dim = document.getElementById('scopeContainer').getBoundingClientRect()
            , mainWidth   = window.main.getSizes().width
            , mainHeight  = window.main.getSizes().height
            , mainZoom    = window.main.getSizes().realZoom
            , thumbWidth  = window.thumb.getSizes().width
            , thumbHeight = window.thumb.getSizes().height
            , thumbZoom =  window.thumb.getSizes().realZoom;

          var thumbPanX = evt.clientX - dim.left - thumbWidth / 2;
          var thumbPanY = evt.clientY - dim.top - thumbHeight / 2;

          var mainPanX = - thumbPanX * mainZoom / thumbZoom;
          var mainPanY = - thumbPanY * mainZoom / thumbZoom;

          window.main.pan({x:mainPanX, y:mainPanY});
        };

        updateScope();
      };
    </script>

  </body>

</html>
